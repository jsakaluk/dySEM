# dySEM

## Summary

The `dySEM` helps automate the process of scripting, fitting, and
reporting on latent models of dyadic data via
[`lavaan`](https://lavaan.ugent.be). The package was initially developed
and used in the course of the research described in Sakaluk, Fisher, and
Kilshaw (2021), and has since undergone considerable expansion.

`dySEM` currently contains 68 functions, of which 25 are user-facing
(i.e., exported), which are covered by 498 unit tests.

The `dySEM` logo was designed by Lowell Deranleau (for logo design
inquiries, email: <agangofwolves@gmail.com>).

## Installation

You can install the released version of dySEM from
[CRAN](https://cran.r-project.org) with:

``` r
install.packages("dySEM")
```

You can install the development version from
[GitHub](https://github.com/) with:

``` r

devtools::install_github("jsakaluk/dySEM")
```

## Current Functionality

The package currently provides functionality regarding the following
types of latent dyadic data models:

**Uni-Construct Models**

1.  Univariate Dyadic Model
2.  Correlated Dyadic Factors Model
3.  Hierarchical Dyadic Factor Model
4.  Bifactor Dyadic Model

**Bi-Construct Models**

1.  Latent Actor-Partner Interdependence Models (APIM)
2.  Latent Common Fate Models (CFM)
3.  Latent Bifactor Dyadic (Bi-Dy) Models
4.  Observed Actor-Partner Interdependence (APIM)

**Multi-Construct Models**

1.  Multiple Correlated Dyadic Factors Model (Dyadic Confirmatory Factor
    Analysis)
2.  Dyadic Exploratory Factor Analysis

**Indistinguishability-Related Models**

1.  I-SAT Model
2.  I-NULL Model

Additional features currently include:

- Automated specification of invariance constraints for any model,
  including full indistinguishability
- Wrapper-function to provide variable-and-parameter specific tests of
  noninvariance
- Functions to assist with reproducible creation of path diagrams and
  tables of statistical output
- Functions to calculate supplemental statistical information (e.g.,
  omega reliability, noninvariance effect sizes, corrected model fit
  indexes)

## Future Functionality

Shorter-term development goals include:

1.  Improving test coverage
2.  Covariate scripting and optionality
3.  Improved ease of item selection in scraper functions

Longer-term goals, meanwhile, include:

1.  “Third-variable” models (e.g., mediators and moderators)
2.  Longitudinal dyadic model scripting functions (e.g., curve of
    factors, common fate growth)
3.  Latent dyadic response surface analysis scripting and visualization
    functions
4.  Multi-group dyadic model scripting (e.g., comparing models from
    samples of heterosexual vs. LGBTQ+ dyads)

## Collaboration

Please submit any feature requests via the `dySEM`
[issues](https://github.com/jsakaluk/dySEM/issues) page, using the
“Wishlist for dySEM Package Development” tag.

If you are interested in collaborating on the development of `dySEM`,
please contact Dr. Sakaluk.

## dySEM Workflow

A `dySEM` workflow typically involves five steps, which are covered
in-depth in the [Overview
vignette](https://jsakaluk.github.io/dySEM/articles/dySEM.html).
Briefly, these steps include:

1.  Import and wrangle **data**
2.  **Scrape** variables from your data frame
3.  **Script** your preferred model
4.  **Fit** and **Inspect** your model via `lavaan`
5.  **Output** statistical visualizations and/or tables

There are additional optional functions, as well, that help users to
calculate certain additional quantitative values (e.g., reliability,
corrected model fit indexes in models with indistinguishable dyad
members).

``` R
#> Warning: package 'ggplot2' was built under R version 4.4.3
```

### 1. Import and wrangle **data**

Structural equation modeling (SEM) programs like `lavaan` require dyadic
data to be in dyad structure data set, whereby each row contains the
data for one dyad, with separate columns for each observation made for
each member of the dyad. For example:

``` r
DRES
#> # A tibble: 121 × 18
#>    PRQC_1.1 PRQC_2.1 PRQC_3.1 PRQC_4.1 PRQC_5.1 PRQC_6.1 PRQC_7.1 PRQC_8.1
#>       <int>    <int>    <int>    <int>    <int>    <int>    <int>    <int>
#>  1        7        7        7        7        7        7        7        5
#>  2        6        6        6        7        7        6        5        5
#>  3        7        7        7        7        7        7        7        6
#>  4        6        6        6        7        7        6        5        6
#>  5        7        7        7        7        7        6        7        6
#>  6        6        6        6        6        6        3        6        5
#>  7        7        6        7        6        6        6        5        6
#>  8        6        7        7        7        7        6        5        6
#>  9        7        7        7        7        7        6        6        6
#> 10        6        6        6        7        7        7        4        4
#> # ℹ 111 more rows
#> # ℹ 10 more variables: PRQC_9.1 <int>, PRQC_1.2 <int>, PRQC_2.2 <int>,
#> #   PRQC_3.2 <int>, PRQC_4.2 <int>, PRQC_5.2 <int>, PRQC_6.2 <int>,
#> #   PRQC_7.2 <int>, PRQC_8.2 <int>, PRQC_9.2 <int>
```

### 2. **Scrape** variables from your data frame

The `dySEM` scrapers consider appropriately repetitiously named
indicators as consisting of at least three distinct elements: stem,
item, and partner. **Delimiter** characters (e.g., “.”, “\_“) are
commonly–but not always–used to separate some/all of these
elements.`dySEM` scrapers largely function by asking you to specify in
what order the elements of variable names are ordered.

``` r
dvn <- scrapeVarCross(DRES, x_order = "sip", x_stem = "PRQC", x_delim1="_",x_delim2=".",  distinguish_1="1", distinguish_2="2")
#> 
#> ── Variable Scraping Summary ──
#> 
#> ✔ Successfully scraped 1 latent variable: PRQC
#> ℹ PRQC: 9 indicators for P1 (1), 9 indicators for P2 (2)
#> ℹ Total indicators: 18
```

### 3. **Script** your preferred model

*Scripter* functions like
[`scriptCor`](https://github.com/jsakaluk/dySEM/blob/master/R/scriptCor.R)
typically require only three arguments to be specified:

1.  the `dvn` object (e.g., from `scrapeVarCross`) to be used to script
    the model
2.  arbitrary name(s) for the latent variable(s) you are modeling
3.  the kind of parameter equality constraints that you wish to be
    imposed (if any)

``` r
qual.indist.script <- scriptCor(dvn, lvname = "Quality")
```

This function returns a character object with `lavaan` compliant syntax
for your chosen model, as well as exporting a reproducible .txt of the
scripted model to a /scripts folder in your working directory.

### 4. **Fit** and **Inspect** your model via `lavaan`

You can immediately pass any script(s) returned from a `dySEM` scripter
to your preferred `lavaan` wrapper, with your estimator and missing data
treatment of choice. For example:

``` r
qual.indist.fit <- lavaan::cfa(qual.indist.script, data = DRES, std.lv = FALSE, auto.fix.first= FALSE, meanstructure = TRUE)
```

At this point, the full arsenal of `lavaan` model-inspecting tools are
at your disposal. For example:

``` r
summary(qual.indist.fit, fit.measures = TRUE, standardized = TRUE, rsquare = TRUE)
```

### 5. **Output** statistical visualizations and/or tables

`dySEM` also contains functionality to help you quickly, correctly, and
reproducibly generate output from your fitted model(s), in the forms of
path diagrams and/or tables of statistical values. By default these save
to a temporary directory, but you can specify a directory of your choice
by replacing [`tempdir()`](https://rdrr.io/r/base/tempfile.html) (e.g.,
with `"."`, which will place it in your current working directory).

``` r

outputParamTab(dvn, model = "cfa", fit = qual.indist.fit, 
               tabletype = "measurement", writeTo = tempdir(), 
               fileName = "cfa_indist")

outputParamFig(fit = qual.indist.fit, figtype = "standardized",
               writeTo = tempdir(), 
               fileName = "cfa_indist")
```

## Code of Conduct

Please note that the dySEM project is released with a [Contributor Code
of Conduct](https://jsakaluk.github.io/dySEM/CODE_OF_CONDUCT.html). By
contributing to this project, you agree to abide by its terms.

## Acknowledgements

The development of `dySEM` has been generously supported by Internal
Grants from Western University, including:

- a Research Mobilization, Creation & Innovation Grants for
  SSHRC-Related Research
- a Western Knowledge Mobilization Innovation Grants

# Package index

## All functions

- [`DRES`](https://jsakaluk.github.io/dySEM/reference/DRES.md) :
  Relationship quality and sexual satisfaction of 121 couples
- [`commitmentM`](https://jsakaluk.github.io/dySEM/reference/commitmentM.md)
  : Ratings of relational satisfaction and commitment from 282
  (M)ixed-sex couples
- [`commitmentQ`](https://jsakaluk.github.io/dySEM/reference/commitmentQ.md)
  : Ratings of relational satisfaction and commitment from 282 (Q)ueer
  couples
- [`getConstraintTests()`](https://jsakaluk.github.io/dySEM/reference/getConstraintTests.md)
  : A function that performs a score test for relaxing each invariance
  equality constraint between partners in a given dyadic SEM model.
- [`getDyReliability()`](https://jsakaluk.github.io/dySEM/reference/getDyReliability.md)
  : A Function Calculates Omega Total Coefficients from a Dyadic CFA
- [`getDydmacs()`](https://jsakaluk.github.io/dySEM/reference/getDydmacs.md)
  : Calculates dmacs difference in expected indicator scores for between
  dyad members
- [`getIndistFit()`](https://jsakaluk.github.io/dySEM/reference/getIndistFit.md)
  : A Function that Computes Corrected Fit Indexes According to the ISAT
  and INULL Models of Olsen & Kenny (2006)
- [`getInvarCompTable()`](https://jsakaluk.github.io/dySEM/reference/getInvarCompTable.md)
  : Compare model fit of nested dyadic invariance models in order from
  most parsimonious (residual) to least parsimonious (configural)
- [`imsM`](https://jsakaluk.github.io/dySEM/reference/imsM.md) : Ratings
  on the full Investment Model Scale (IMS) from 282 (M)ixed-sex couples
- [`outputConstraintTab()`](https://jsakaluk.github.io/dySEM/reference/outputConstraintTab.md)
  : Evaluate Invariance Equality Constraints in a specified Dyadic
  Invariance Model
- [`outputInvarCompTab()`](https://jsakaluk.github.io/dySEM/reference/outputInvarCompTab.md)
  : Compare Model Fit of Nested Dyadic Invariance Models
- [`outputModel()`](https://jsakaluk.github.io/dySEM/reference/outputModel.md)
  : A Function That Exports Tables and/or SEM Diagrams based on dySEM
  models
- [`outputParamFig()`](https://jsakaluk.github.io/dySEM/reference/outputParamFig.md)
  : A function That Exports SEM diagrams based on dySEM models
- [`outputParamTab()`](https://jsakaluk.github.io/dySEM/reference/outputParamTab.md)
  : A Function That Exports Tables based on dySEM models
- [`outputUniConstructComp()`](https://jsakaluk.github.io/dySEM/reference/outputUniConstructComp.md)
  : A Function That Fits and Compares Competing Dyadic Uni-construct
  Models
- [`prqcQ`](https://jsakaluk.github.io/dySEM/reference/prqcQ.md) :
  Ratings on items from the Perceived Relationship Quality Components
  (PRQC) Inventory from 118 (Q)ueer couples
- [`scrapeVarCross()`](https://jsakaluk.github.io/dySEM/reference/scrapeVarCross.md)
  : A Variable Name-Scraping and Indexing Function for cross-sectional
  data
- [`scriptAPIM()`](https://jsakaluk.github.io/dySEM/reference/scriptAPIM.md)
  : A Function That Writes, Saves, and Exports Syntax for Fitting Latent
  Actor-Partner Interdependence Models (APIMs)
- [`scriptBiDy()`](https://jsakaluk.github.io/dySEM/reference/scriptBiDy.md)
  : A Function That Writes, Saves, and Exports Syntax for Fitting
  Bifactor Dyadic (BiDy) models
- [`scriptBifac()`](https://jsakaluk.github.io/dySEM/reference/scriptBifac.md)
  : A Function That Writes, Saves, and Exports Syntax for Fitting
  Bifactor Dyadic Models
- [`scriptCFA()`](https://jsakaluk.github.io/dySEM/reference/scriptCFA.md)
  : A Function That Writes, Saves, and Exports Syntax for Fitting Latent
  Dyadic Confirmatory Factor Analysis (CFA) Models with Multiple Factors
- [`scriptCFM()`](https://jsakaluk.github.io/dySEM/reference/scriptCFM.md)
  : A Function That Writes, Saves, and Exports Syntax for Fitting Latent
  Common Fate Models (CFMs)
- [`scriptCor()`](https://jsakaluk.github.io/dySEM/reference/scriptCor.md)
  : A Function That Writes, Saves, and Exports Syntax for Fitting
  Correlated Dyadic Factor Models
- [`scriptDyEFA()`](https://jsakaluk.github.io/dySEM/reference/scriptDyEFA.md)
  : A Function That Writes, Saves, and Exports Syntax for Fitting Dyadic
  Exploratory Factor Analysis (DEFA) Models
- [`scriptHier()`](https://jsakaluk.github.io/dySEM/reference/scriptHier.md)
  : A Function That Writes, Saves, and Exports Syntax for Fitting
  Hierarchical Dyadic Factor Models
- [`scriptINULL()`](https://jsakaluk.github.io/dySEM/reference/scriptINULL.md)
  : A Function That Writes, Saves, and Exports Syntax for Fitting the
  I-NULL model for indistinguishable dyads
- [`scriptISAT()`](https://jsakaluk.github.io/dySEM/reference/scriptISAT.md)
  : A Function That Writes, Saves, and Exports Syntax for Fitting the
  I-SAT model for indistinguishable dyads
- [`scriptMIM()`](https://jsakaluk.github.io/dySEM/reference/scriptMIM.md)
  : A Function That Writes, Saves, and Exports Syntax for Fitting Latent
  Mutual influence Model
- [`scriptObsAPIM()`](https://jsakaluk.github.io/dySEM/reference/scriptObsAPIM.md)
  : A Function That Writes, Saves, and Exports Syntax for Fitting
  Observed Actor-Partner Interdependence Models
- [`scriptUni()`](https://jsakaluk.github.io/dySEM/reference/scriptUni.md)
  : A Function That Writes, Saves, and Exports Syntax for Fitting
  Unidimensional Dyadic Factor Models

# Articles

### The Big Picture of Using dySEM

- [dySEM overview](https://jsakaluk.github.io/dySEM/articles/dySEM.md):
- [Anatomy of a Variable
  Name](https://jsakaluk.github.io/dySEM/articles/varnames.md):

### Tutorials for Specific Models

- [Fitting and Interpreting the Correlated Dyadic Factors Model
  (CDFM)](https://jsakaluk.github.io/dySEM/articles/CDFM.md):
- [Fitting and Interpreting the Multiple Correlated Dyadic Factors Model
  (M-CDFM)](https://jsakaluk.github.io/dySEM/articles/M-CDFM.md):
- [Fitting and Interpreting the Latent Actor-Partner Interdependence
  Model (L-APIM)](https://jsakaluk.github.io/dySEM/articles/L-APIM.md):
- [Invariance Testing with Potentially Indistinguishable Dyads:
  Rationale and Practices for a More Logical and Inclusive Testing
  Sequence](https://jsakaluk.github.io/dySEM/articles/invariance.md):
